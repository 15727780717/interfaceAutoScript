{"uid":"2b1c9f7c682bcfba","name":"test_case[switch_primary_club]","fullName":"testcases.scenario.test_api.TestAPI#test_case","historyId":"449400288508e856045cfe33a15b0ca1","time":{"start":1745481655378,"stop":1745481655380,"duration":2},"status":"broken","statusMessage":"KeyError: '全局变量key错误: primaryTokenId'","statusTrace":"self = <testcases.scenario.test_api.TestAPI object at 0x04DC9820>\ncase = {'assertions': [{'eq': ['status_code', 200]}, {'eq': ['$.code', 0]}, {'eq': ['$.msg', 'success']}], 'name': 'switch_pr...club', 'request': {'data': {'tokenId': '${primaryTokenId}'}, 'method': 'POST', 'url': '/api/v1/client/passports/main'}}\napi_client = <utils.request_handler.RequestHandler object at 0x052C14A8>\nauth_headers = {'Content-Type': 'application/json', 'Token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjoiMHg3ZGE3YjNjMTBmYmQwNT...hxM3FyIiwibG9naW5UeXBlIjo3LCJpYXQiOjE3NDU0ODE2MjEsImV4cCI6MTc0NTUyNDgyMX0.cjW4x6R4dq4iWFMIIKaKj_zj6VVNqdzA-z3krVx32WE'}\n\n    @pytest.mark.parametrize(\"case\", cases, ids=[case['name'] for case in cases])\n    @allure.severity(allure.severity_level.CRITICAL)\n    def test_case(self, case, api_client, auth_headers):\n        with allure.step(\"测试用例名称: {}\".format(case[\"name\"])):\n            # 处理请求参数\n            request_data = case['request']\n            # 发送请求\n            with allure.step(\"发送请求\"):\n                try:\n>                   response = api_client.send_request(\n                        method=request_data['method'],\n                        url=request_data['url'],\n                        headers=auth_headers,\n                        data=request_data.get('data')\n                    )\n\ntestcases\\scenario\\test_api.py:26: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nutils\\request_handler.py:38: in send_request\n    processed = replace_global_params(processed)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\ntext = '${primaryTokenId}'\n\n    def replace_global_params(text):\n        \"\"\"\n        替换 text 中的 ${变量名} 为全局参数值，若参数不存在则抛出 KeyError\n        :param text: 字符串\n        :return: 替换全局变量参数值后的字符串\n        \"\"\"\n        PATTERN = r'\\$\\{([a-zA-Z_][a-zA-Z0-9_]*)\\}'\n        matches = re.findall(PATTERN, text)\n        for param_name in matches:\n            if param_name in GlobalContext.params:\n                # 将参数值强制转换为字符串\n                param_value = str(GlobalContext.params[param_name])\n                # 使用正则表达式进行准确替换\n                text = re.sub(\n                    rf'\\$\\{{{param_name}}}',\n                    re.escape(param_value),  # 处理参数值中的特殊字符\n                    text\n                )\n            else:\n>               raise KeyError(f\"全局变量key错误: {param_name}\")\nE               KeyError: '全局变量key错误: primaryTokenId'\n\nutils\\replace_dynamic_parameters.py:63: KeyError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":2,"retriesStatusChange":false,"beforeStages":[{"name":"api_client","time":{"start":1745481655377,"stop":1745481655377,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false}],"testStage":{"status":"broken","statusMessage":"KeyError: '全局变量key错误: primaryTokenId'","statusTrace":"self = <testcases.scenario.test_api.TestAPI object at 0x04DC9820>\ncase = {'assertions': [{'eq': ['status_code', 200]}, {'eq': ['$.code', 0]}, {'eq': ['$.msg', 'success']}], 'name': 'switch_pr...club', 'request': {'data': {'tokenId': '${primaryTokenId}'}, 'method': 'POST', 'url': '/api/v1/client/passports/main'}}\napi_client = <utils.request_handler.RequestHandler object at 0x052C14A8>\nauth_headers = {'Content-Type': 'application/json', 'Token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjoiMHg3ZGE3YjNjMTBmYmQwNT...hxM3FyIiwibG9naW5UeXBlIjo3LCJpYXQiOjE3NDU0ODE2MjEsImV4cCI6MTc0NTUyNDgyMX0.cjW4x6R4dq4iWFMIIKaKj_zj6VVNqdzA-z3krVx32WE'}\n\n    @pytest.mark.parametrize(\"case\", cases, ids=[case['name'] for case in cases])\n    @allure.severity(allure.severity_level.CRITICAL)\n    def test_case(self, case, api_client, auth_headers):\n        with allure.step(\"测试用例名称: {}\".format(case[\"name\"])):\n            # 处理请求参数\n            request_data = case['request']\n            # 发送请求\n            with allure.step(\"发送请求\"):\n                try:\n>                   response = api_client.send_request(\n                        method=request_data['method'],\n                        url=request_data['url'],\n                        headers=auth_headers,\n                        data=request_data.get('data')\n                    )\n\ntestcases\\scenario\\test_api.py:26: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nutils\\request_handler.py:38: in send_request\n    processed = replace_global_params(processed)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\ntext = '${primaryTokenId}'\n\n    def replace_global_params(text):\n        \"\"\"\n        替换 text 中的 ${变量名} 为全局参数值，若参数不存在则抛出 KeyError\n        :param text: 字符串\n        :return: 替换全局变量参数值后的字符串\n        \"\"\"\n        PATTERN = r'\\$\\{([a-zA-Z_][a-zA-Z0-9_]*)\\}'\n        matches = re.findall(PATTERN, text)\n        for param_name in matches:\n            if param_name in GlobalContext.params:\n                # 将参数值强制转换为字符串\n                param_value = str(GlobalContext.params[param_name])\n                # 使用正则表达式进行准确替换\n                text = re.sub(\n                    rf'\\$\\{{{param_name}}}',\n                    re.escape(param_value),  # 处理参数值中的特殊字符\n                    text\n                )\n            else:\n>               raise KeyError(f\"全局变量key错误: {param_name}\")\nE               KeyError: '全局变量key错误: primaryTokenId'\n\nutils\\replace_dynamic_parameters.py:63: KeyError","steps":[{"name":"测试用例名称: switch_primary_club","time":{"start":1745481655378,"stop":1745481655380,"duration":2},"status":"broken","statusMessage":"KeyError: '全局变量key错误: primaryTokenId'\n","statusTrace":"  File \"C:\\Users\\16592\\Desktop\\interfaceAutoScript\\testcases\\scenario\\test_api.py\", line 26, in test_case\n    response = api_client.send_request(\n  File \"C:\\Users\\16592\\Desktop\\interfaceAutoScript\\utils\\request_handler.py\", line 38, in send_request\n    processed = replace_global_params(processed)\n  File \"C:\\Users\\16592\\Desktop\\interfaceAutoScript\\utils\\replace_dynamic_parameters.py\", line 63, in replace_global_params\n    raise KeyError(f\"全局变量key错误: {param_name}\")\n","steps":[{"name":"发送请求","time":{"start":1745481655378,"stop":1745481655379,"duration":1},"status":"broken","statusMessage":"KeyError: '全局变量key错误: primaryTokenId'\n","statusTrace":"  File \"C:\\Users\\16592\\Desktop\\interfaceAutoScript\\testcases\\scenario\\test_api.py\", line 26, in test_case\n    response = api_client.send_request(\n  File \"C:\\Users\\16592\\Desktop\\interfaceAutoScript\\utils\\request_handler.py\", line 38, in send_request\n    processed = replace_global_params(processed)\n  File \"C:\\Users\\16592\\Desktop\\interfaceAutoScript\\utils\\replace_dynamic_parameters.py\", line 63, in replace_global_params\n    raise KeyError(f\"全局变量key错误: {param_name}\")\n","steps":[],"attachments":[{"uid":"d62e2c06b4d9785b","name":"请求异常","source":"d62e2c06b4d9785b.attach","type":"text/plain","size":39}],"parameters":[],"attachmentsCount":1,"shouldDisplayMessage":true,"stepsCount":0,"attachmentStep":false,"hasContent":true}],"attachments":[],"parameters":[],"attachmentsCount":1,"shouldDisplayMessage":false,"stepsCount":1,"attachmentStep":false,"hasContent":true}],"attachments":[],"parameters":[],"attachmentsCount":1,"shouldDisplayMessage":true,"stepsCount":2,"attachmentStep":false,"hasContent":true},"afterStages":[{"name":"api_client::0","time":{"start":1745481655388,"stop":1745481655388,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false}],"labels":[{"name":"severity","value":"critical"},{"name":"feature","value":"API测试"},{"name":"parentSuite","value":"testcases.scenario"},{"name":"suite","value":"test_api"},{"name":"subSuite","value":"TestAPI"},{"name":"host","value":"Partyverse"},{"name":"thread","value":"2320-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"testcases.scenario.test_api"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"case","value":"{'name': 'switch_primary_club', 'request': {'method': 'POST', 'url': '/api/v1/client/passports/main', 'data': {'tokenId': '${primaryTokenId}'}}, 'assertions': [{'eq': ['status_code', 200]}, {'eq': ['$.code', 0]}, {'eq': ['$.msg', 'success']}]}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[{"uid":"4727fff82f0f300d","status":"broken","statusDetails":"KeyError: '全局变量key错误: primaryTokenId'","time":{"start":1745481653348,"stop":1745481653350,"duration":2}},{"uid":"f6c22f14cb243045","status":"broken","statusDetails":"KeyError: '全局变量key错误: primaryTokenId'","time":{"start":1745481651323,"stop":1745481651324,"duration":1}}],"categories":[{"name":"Test defects","matchedStatuses":[]}],"tags":[]},"source":"2b1c9f7c682bcfba.json","parameterValues":["{'name': 'switch_primary_club', 'request': {'method': 'POST', 'url': '/api/v1/client/passports/main', 'data': {'tokenId': '${primaryTokenId}'}}, 'assertions': [{'eq': ['status_code', 200]}, {'eq': ['$.code', 0]}, {'eq': ['$.msg', 'success']}]}"]}